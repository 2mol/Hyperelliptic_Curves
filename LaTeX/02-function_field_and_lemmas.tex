\documentclass[english,11pt,a4paper]{article}
\usepackage{preamble}

\begin{document}

Version 1 \scriptsize \hfill Juri; Hyperelliptic Curves --- Draft --- \today
\normalsize

\section{Rational Functions on Hyperelliptics}

The goal of this chapter is to look at rational functions on the hyperelliptic curve $y^2 = C(x)$ and to define a notion of the order of a function in a point on the curve. We then give some basic properties for this order function before we introduce divisors and proceed to look at functions with a specified number of poles at $\infty$ as a preparation for the proof of associativity on $\J$. %introduce divisors with the ultimate goal of xxx Blah

% \subsection{The Function Field}
\subsection{Function Field and Order of Rational Functions}

\begin{defin}
	Define the ring of rational functions on the curve as
	\begin{align*}
	  \F = \bigslant{K(x)[y]}{\big(y^2-C(x)\big)}.
	\end{align*}
  % Define $\F$ to be the ring \scalebox{1.2}{$\nicefrac{K(x)[y]}{(y^2-C(x))}$}. Because \mbox{$y^2-C(x)$} is irreducible in $K(x)[y]$ the ideal it generates is maximal and so $\F$ is a field.
  As $y^2-C(x)$ is irreducible in $K(x)[y]$, $\F$ is a field
  % xxx want me to write why?
  and $\F = K(x) + K(x) y$, so write elements $f \in \F$ as $f = g + hy$ where $g,h \in K(x)$. Define $\bar f = g - hy$.

  We will occasionally write things like $K[x,y] \subset \F$ but this is always implicitly understood to be in conjunction with $y^2=C(x)$.
\end{defin}

\vspace{3mm}

\textbf{Reminders}: For a field $K$ with char$(K) \neq 2$ a formal Laurent series written $\tau = \gamma t^e (1 + \dots)\in K (\! (t)\! )$ with $\gamma \in K^*$, $e \in \mathbbm{Z}$ has a a unique inverse $\tau^{-1} = \gamma^{-1} t^{-e} (1 + \dots) \in K (\! (t)\! )$.

From now on we will use an ellipsis to denote any terms of ascending order everywhere where we are not interested in the specifics.

If $\tau$ is a formal Laurent series of the form $\tau = 1 + \sum_{i = 1}^{\infty} a_i t^i$ then it has a unique squareroot of the form $\sigma = 1+\sum_{i = 1}^{\infty} b_i t^i$ in $\bar K (\! (t)\! )$ meaning $\sigma^2 = \tau$. Write $\sigma = \sqrt \tau = 1 + \dots$.

\vspace{-3mm}
\begin{center}
$\sim$
\end{center}

In order to define the order of a function $f$ in a point $\q$, $\ordq (f) \in \mathbbm{Z}$ for $f \in \F^*$ and $\q \in \ekb$ we first construct a $K$-homomorphism
\begin{align*}
  \lp: \F \rightarrow \bar K (\! (t)\! )
\end{align*}
% with the intent of defining $\ordq(f) = \ord \lp (f)$.
Because $C\big(\lpx\big)=\big(\lpy\big)^2$ has to be fulfilled, we decide on $\lpx$ and deduce $\lpy$. For this, we distinguish between three cases for $\q \in \ekb$.

\begin{defin}
	\begin{enumerate}[1.]
		\item Let $\q =(x_0,y_0) \in \enkb$ with $y_0 \neq 0$ and consequently $C(x_0)\neq 0$.

		Define $\lpx = x_0 + t$. Now
		\begin{align*}
		  C(\lpx) &= C(x_0+t)\\
		          &= C(x_0)+ \dots + t^5\\
		          &= C(x_0)(1 + \dots)\\ % \text{ since } C(x_0) = y_0^2\neq 0\\
		          &= y_0^2 \tau_1 \text{\hspace{5mm} with } \tau_1 \in K (\! (t)\! ).
		\end{align*}
		Define $\lpy = y_0 \sqrt{\tau_1}$.

		\item Let $\q =(x_0,y_0) \in \enkb$ with $y_0 = 0$.	Note that $C(x_0)=0$ and write $C(x)=\prod_{i=1}^5 (x-\alpha_i)$ for $\alpha_i \in \bar K$ and for instance $\alpha_1 = x_0$.

		Define $\lpx = x_0 + t^2$. Now
		\begin{align*}
		  C(\lpx) &= t^2 \prod_{i=2}^5 (x_0 -\alpha_i + t^2) \\
		          % &= \mu t^2 + \dots\\
		          &= \mu t^2 (1 + \dots)
		\end{align*}
		with $\mu \in \bar K$ being $\mu = \prod_{i=2}^5 (x_0 - \alpha_i) = C'(x_0)$ which is non-zero because our curve is non-singular. Write therefore $C(\lpx) = \mu t^2 \tau_2$ with $\tau_2 = 1 + \dots$ and define $\lpy = \nu t \sqrt{\tau_2}$ with $\nu^2 = \mu$.

		Note that we may choose one out of two squareroots for $\nu$ so whichever we take we naturally demand that we stay consistent in our choice. %$\nu = \sqrt{\mu}$ for a fixed $\sqrt{\phantom{j}}:K\rightarrow K$.

		\item Let $\q = \infty$. Define $\lpx = t^{-2}$. It follows that
		\begin{align*}
			C(t^{-2}) &= t^{-10} + at^{-8} + bt^{-6}
											  + ct^{-4}    + dt^{-2} + e\\
											 &= t^{-10} \sqrt{\tau_3}
		\end{align*}
		so define $\lpy = t^{-5} \sqrt{\tau_3}$.
	\end{enumerate}
\end{defin}


\vspace{-3mm}
\fline
\vspace{-3mm}
\begin{defin}
   For $\q \in \ekb$ and $f \in \F^*$ define $\ordq (f) = \ord \lp (f)$.
\end{defin}
\vspace{-5.5mm}
\fline

% \begin{center}
% $\sim$
% \end{center}
% \vspace{0.6mm}

\begin{lemma}\label{one}
  Let $f \in K[x,y] \subset \F$, $f \neq 0$ and $\q \in \enkb$, $\q = (x_0,y_0)$. Then
  \begin{enumerate}[(a)]\parskip 1mm
	  \item ord$_{\q} f \geq 0$ and
	  \item if $f(\q) = 0$ then ord$_{\q} f \geq 1$.
	\end{enumerate}\parskip 3mm
	\begin{proof}\hfill
		\begin{enumerate}[(a)]\parskip 1mm
	  	\item Because $\q \in \enkb$ we have $\lpx$, $\lpy \in \bar K[[t]]$ so with $f \in K[x,y]$ we have $\ordq (f) \in \mathbbm{N}$.
	  	\item Write $f = A(x,y)$, $A(X,Y) \in K[X,Y]$. First, let $y_0 \neq 0$.
	  	\begin{align*}
	  	  \ordq f &= \ord A(\lpx, \lpy)\\
	  	  &= \ord A(x_0 + t, y_0 \sqrt \tau_1).
	  	\end{align*}
	  	But $A(x_0 + t, y_0 \sqrt \tau_1)=\sum_{i=0}^{\infty} a_i t^i$ so with $t=0$ we get $A(x_0, y_0)=a_0$ but the former is $f(\q)$ which is $0$, so $a_0 = 0$ and the claim follows.

	  	If $y_0 = 0$ we would have $\ordq f = \ord A(x_0 + t^2, \nu t \sqrt \tau_2)$ instead. But like before, this means $0 = f(\q) = A(x_0, 0) = a_0$ so again $\ordq (f) \geq 1$.
		\end{enumerate}\parskip 3mm
	\end{proof}
\end{lemma}

\begin{lemma}\label{two}
  Let $f \in K(x) \subset \F$, $f \neq 0$, $\q \in \ekb$. Then
  \begin{enumerate}[(a)]\parskip 1mm
	  \item $\ordq (f) = \ordx f(x)$ if $\q = (x_0,y_0) \in \enkb$ with $y_0 \neq 0$.
	  \item $\ordq (f) = 2 \ordx f(x)$ if $\q = (x_0,0) \in \enkb$.
	  \item $\ordi (f) = 2 \ordii f(x) = 2 \ordn f(\frac 1 x)$.
	\end{enumerate}\parskip 3mm
	\textbf{Note} that the righthand sides of the equalities refer to the usual definition of the order of a rational function in a point $x_0 \in \bar K \cup \{ \ii \}$.%xxx We renamed the infinity in order to avoid a clash of notations.
	\begin{proof}
		First take $f \in K[x]$ and define $e = \ordx f \in \mathbbm{N}$ so $f = (x-x_0)^e g(x)$ with $g \in \bar K[x]$ and $g(x_0)\neq 0$.
		\begin{enumerate}[(a)]
	  	\item If $\q =(x_0,y_0)$, $y_0 \neq 0$ then $\lp (f) = f(x_0 + t) = t^e g(x_0 + t)$ and so $\ord \lp (f) = e$ because $g(x_0 + t) = g(x_0) + \dots$ with $g(x_0) \neq 0$.

	  	\item Here $\lp (f) = f(x_0 + t^2) = t^{2e} g(x_0 + t^2)$ and again $g(x_0 + t^2) = g(x_0) + \dots$ so $\ord \lp (f) = 2e$.

	  	\item For $\q = \infty$ we have $\lp (f) = f(t^{-2}) = \kappa t^{-2d}+ \dots$ with $\kappa \neq 0$ if $d = \deg f$ so $\ordn f(\frac 1 x ) = -d$ and so $\ord \lp (f) = 2 \ordn f(\frac 1 x )$.
		\end{enumerate}
		Generally, if $f \in K(x)$ we can write $f = \frac p q$ for $p, q \in K[x]$ and we apply the above to $p$ and $q$, subtracting $\ordq q$ from $\ordq p$.%xxx check this through?
	\end{proof}
\end{lemma}

\begin{lemma}\label{three}
  For $f \in \F^*$ and $\q \in \ekb$ the order satisfies $\ordq(\bar f) = \ordbq (f)$
  \begin{proof} Split into three possible cases:
    \begin{enumerate}[1.]
    	\item For $\q \in \enkb$ with $y_0 \neq 0$ we've got $\lpx = x_0 + t$ and $\lpy = y_0 \sqrt \tau_1$. Therefore $\lpbx = x_0 + t = \lp (\bar x)$ and $\lpby = - y_0 \sqrt \tau_1 = \lp (\bar y)$ so
    	\begin{align*}
    	  \lpb (f(x,y)) &= f(\lpbx , \lpby ) \\
    	  							&= \lp (f(\bar x, \bar y)) \\
    	  							&= \lp (\bar f (x,y)).
    	\end{align*}

    	\item If $\q \in \enkb$ with $y_0 = 0$ then $\bar \q = \q$. Write $f = g(x) + h(x)y$ so
    	\begin{align*}
    	  \lp (\bar f) &= g(x_0 + t^2) - h(x_0 + t^2) \nu t \sqrt{\tau_2}.
    	\end{align*}
    	Calling this $l(t) = \lp (\bar f)$ and looking at the construction of $\lp$ we see that $\tau_2$ sports only even powers of $t$ so we see above that $l(-t) = \lp (f)$. As interchanging $t$ with $-t$ doesn't change the order, we're done.

    	\item For $\q = \infty$, $\tau_3 = 1 + a t^2 + b t^4 + c t^6 + d t^8 + c t^{10}$ features only even powers as well, so again $l(-t) = \lp (f)$ for $l(t) = \lp (\bar f) = g(t^{-2}) - h(t^{-2}) t^{-5} \sqrt{\tau_3}$. Finally, $\lp (f)$ is equal to $\lpb (f)$ since $\infty = \bar \infty$. Again $\ord l(t) = \ord l(-t)$.
    \end{enumerate}
  \end{proof}
\end{lemma}

\begin{lemma}\label{sform}
  %(Summenformel)
  If $f \in \F^*$ then the set $\big \{ \q \in \ekb \ \big | \ \ordq f \neq 0 \big \}$ is finite and 
  \begin{align*}
    \sum_{\q \in \ekb} \ordq f = 0.%\tag{Summenformel}
  \end{align*}
  \begin{proof}
    First take $f \in K[x,y]$, $f \neq 0$ and let $\q = (x_0,y_0) \in \enkb$ with $\ordq f \neq 0$. By Lemma \ref{one} (a) we know that $\ordq f \geq 1$. It follows that $\ordq (f \bar f) = \ordq f + \ordq \bar f \geq 1$. Now since $f = g + h y$, $f \bar f = g^2 - h^2 C(x)$ which lies in $K[x]$, so by Lemma \ref{two} we have $\ordx (f \bar f) = \ordq (f \bar f) \geq 1$. But there are only finitely many such $x_0$ and so only finitely many $y_0 = \pm \sqrt{C(x_0)}$.

    For $f \in K(x,y)$, $f = \frac p q$, $p, q \in K[x,y]$ we have $\ordx f = \ordx p - \ordx q$ so there are also only finitely many $x_0$ for which this differs from zero.

    For the second claim, give a name to our sum
    \begin{align*}
      s(f) &= \sum_{\q \in \ekb} \ordq f
      		 % \stackrel{=}{\text{Lemma \ref{three}}} 
    \end{align*}
    and note that $s(f) = s(\bar f)$ due to Lemma \ref{three} and the fact that we take the sum over all $\q$. Because $\ordq (f \bar f ) = \ordq (f) + \ordq ( \bar f )$ we can see that
    \begin{align*}
      s(f \bar f) &= s(f) + s(\bar f) = 2 s(f).
    \end{align*}
    But because $f \bar f \in K(x)$ we can use Lemma \ref{two} to write this out as
    \begin{align*}
      2s(f) &= \sum_{\q \in \ekb} \ordq f \bar f\\
      			&=2 \sum_{\stackrel{x_0 \neq \infty}{x_0 \neq \alpha_i}} \ordx f \bar f 
      			+ 2 \sum_{x_0 = \alpha_i} \ordx f \bar f 
      			+ 2 \sum_{x_0 = \infty} \ordx f \bar f\\
      			&=2 \sum_{x_0 \in \bar K \cup \{ \infty \}} \ordx f \bar f.
      			%&= \underbrace{2\sum_{\stackrel{x_0 \neq \infty}{x_0 \neq \alpha_i}} \ordx f \bar f}_{Test} + \underbrace{2\sum}_{\text{Lemma \ref{two} (b)}} + \underbrace{2\sum}_{\text{Lemma \ref{two} (c)}}
    \end{align*}
    Here $\alpha_i$ are the points on which $C(x)$ vanishes % and the $2$ in the first term stems from the fact that every $x_0$ comes from two points, $\q$ and $\bar \q$.
    and since
    \begin{align*}
    	\sum_{x_0 \in \bar K \cup \{ \ii \}} \ordx g = 0
    \end{align*}
    for any $g \in K(x)$ we have $s(f) = 0$ in $\mathbbm{Z}$.
  \end{proof}
\end{lemma}

% \begin{center}
% $\sim$
% \end{center}

\subsection{Divisors and Lemmas}

% $\widehat{\infty}$ $\tilde{\infty}$ $\bar{\infty}$ $\breve{\infty}$ $\check{\infty}$ $\underline{\infty}$

% $\ord_{\widehat{\infty}} f(x)$ $\ord_{\tilde{\infty}} f(x)$ $\ord_{\underline{\infty}} f(x)$ $\ord_{\breve{\infty}} f(x)$ $\ord_{\check{\infty}} f(x)$

\begin{defin}
  The divisor of a function $f \in \F$ is the formal sum
  \begin{align*}
    (f) = \sum_{\q \in \ekb} \ordq f \cdot \q
  \end{align*}
  where $(f) = 0$ if $f = 0$. Thanks to Lemma \ref{sform} the sum is finite and the sum of all coefficients is 0.

  Points $\q \in \ekb$ with a positive coefficient in $(f)$ are called zeroes of $f$ while those with a negative coefficient are called poles.
\end{defin}

\begin{lemma}\label{nopol}
	If $f \in \F^*$ has no poles, i.e. $\ordq f \geq 0$ then $f$ is constant.
	\begin{proof}
	  With $f = g + hy$, $\ordq f \geq 0$ for every $\q \in \ekb$ we take a look at $f + \bar f = 2g \in K(x)$ and $f \bar f = g^2 - h^2 C \in K(x)$ and observe that
	  \begin{align*}
	    \ordq (f + \bar f) &\geq \min \{ \ordq f , \ordq \bar f \} \\
	    		&= \min \{ \ordq f , \ordbq f\} \geq 0.
	    \intertext{with Lemma \ref{three} and similarly}
	    \ordq (f \bar f) &= \ordq f + \ordbq f \geq 0.
	  \end{align*}
	  Both are greater than zero because $f$ has no poles and with the help of Lemma \ref{two} we conclude that $\ordx (f + \bar f) \geq 0$ and $\ordx (f \bar f) \geq 0$ respectively.

	  But in $\bar K(x)$, a function $q$ with $\ordx q \geq 0$ for every $x_0 \in \bar K \cup \{ \ii \}$ must be constant, so both $f + \bar f$ and $f \bar f$ are constant functions. Since $f$ is a root of $(T-f)(T-\bar f) = T^2 - (f + \bar f)T + f \bar f \in \bar K[T]$, $f$ lies in $\bar K \hspace{0.5mm} \cap \ \F^* = K$.
	\end{proof}
\end{lemma}

\begin{theorem}\label{satz1}
  For a field $K$, let $x = x(t)$, $y = y(t) \in K(t)$ such that $y(t)^2 = C(x(t))^2$. Then $x(t)$, $y(t) \in K$.
\end{theorem}

\begin{lemma}\label{onepol}
	Suppose $f \in \F^*$ has at most one pole at $\infty$ i.e. $\ordi f \geq -1$ and none for any other $\q \in \enkb$. Then $f$ is equal to a constant $\alpha \in K$.

	\begin{proof}
		With $f = g+hy$ such that $\ordq f \geq 0$ for every $\q \in \enkb$ and $\ordi f = -1$ we can write $\li (f) = \kappa t^{-1} + \dots$ with $\kappa \neq 0$ in $\bar K$. Since we are only interested in the order, replace $f$ with $\kappa^{-1} f$ so $\li (f) = t^{-1} + \dots$.
		%With $f = g+hy$ such that $\ordq f \geq 0$ for every $\q \in \enkb$ we can assume that $\ordi f = -1$ because Lemma~\ref{nopol}. and $\li (f) = \frac 1 t + \dots$. If the trailing coefficient of $\li (f)$ were different from one, we can always xxx where $\alpha \in \bar K$. Due to  we assume that $\alpha \neq 0$ and may even take $\alpha = 1$ by replacing $f$ with $\frac f \alpha$.

		Now remember that $\li (x) = t^{-2}$ so $\li (x - f^2) = \alpha t^{-1} + \dots$, $\alpha \in \bar K$ and finally we have a regular power series $\li (x - f^2 - \alpha f)$ so
		\begin{align*}
		  \ordi (x - f^2 - \alpha f) &\geq 0
		\end{align*}
		and for any other $\q \in \enkb$ we have
		\begin{align*}
		  \ordq (x - f^2 - \alpha f) &\geq \min \{ \ordq (x) , \ordq (f^2) , \ordq f \}
		\end{align*}
		which is positive by virtue of the prerequisite on $f$ and $\lpx = x_0 + \dots$. The previous Lemma now implies $x - f^2 - \alpha f \in \bar K$ so we see $x = f^2 + \alpha f$ as a polynomial $x = X(f)$ with $X(T) \in \bar K[T] \setminus \bar K$.

		Do the same thing with $\li (x) = t^{-5}\sqrt \tau_3 = t^{-5} + \dots$ so
		\begin{align*}
		  \li (y - f^5) &= \beta_4 t^{-4} + \dots,\\
		  \li (y - f^5 - \beta_4 f^4) &= \beta_3 t^{-3} + \dots
		\end{align*}
		and so on, so $\li (y - f^5 - \beta_4 f^4 - \beta_3 f^3 - \beta_2 f^2 - \beta_1 f)$ is a power series too:

		As before $y = f^5 + \beta_4 f^4 + \beta_3 f^3 + \beta_2 f^2 + \beta_1 f = Y(f)$ with $Y(T)\in \bar K[T] \setminus \bar K$
		because as above we can take the minimal order for every $\q \in \enkb$ of the terms in the sum $y - Y(f)$ to get $\ordq (y - Y(f)) \geq 0$.
		

		Combined we have $Y(f)^2 = C(X(f))$ but $K$ is algebraically closed, so either $f \in K$ or $Y(T)^2 = C(X(T))$. The latter can't be true by Theorem \ref{satz1} and the former is in contradiction to $\ordi f = -1$, so actually $\ordi f \geq 0$.% so $\left. Y(T)^2 - C(X(T)) \right|_{T=f} = 0$. This means that either
	\end{proof}
\end{lemma}

% \begin{lemma}%xxx incorporate this in proof of next lemma
%   If $f$ is such that $\li (f)=\kappa t^3 + \dots$ then $\li (\bar f)=-\kappa t^3 + \dots$
% \begin{proof}
% 	By Lemma \ref{three} let $\li (\bar f) = \tilde \kappa t^3 + \dots$. Since $f + \bar f = 2p$ and ord$_\infty(p)$ is always even for $p \in K(x)$, we must have $\kappa + \tilde \kappa =0$.
% \end{proof}
% \end{lemma}

\begin{lemma}\label{twopol}
	If $f \in \F^*$ has at most two poles at $\infty$ and $\ordq f \geq 0$ for every $\q \in \enkb$ then $f$ is of the form $f = \alpha + \beta x$ with $\alpha, \beta \in K$.
	\begin{proof}
		Because $\li (f) = \beta t^{-2} + \dots$ where $\beta \in \bar K$ we have $\li (f - \beta x)= \gamma t^{-1} + \dots$ and thanks to Lemma \ref{onepol} we know this to imply $f - \beta x = \alpha$.
	\end{proof}
\end{lemma}

% \begin{remark}
%   Its easy to see that if $f$ is such that $\li (f)=\kappa t^3 + \dots$ then $\li (\bar f)=-\kappa t^3 + \dots$.	By Lemma \ref{three} let $\li (\bar f) = \tilde \kappa t^3 + \dots$. Since $f + \bar f = 2p$ and ord$_\infty(p)$ is always even for $p \in K(x)$, we must have $\kappa + \tilde \kappa =0$.
% \end{remark} 

\begin{lemma}
	If $f \in \F^*$ has at most three poles at $\infty$ and $\ordq f \geq 0$ for every $\q \in \enkb$ then $f$ is of the form $f = \alpha + \beta x$ with $\alpha, \beta \in K$.
	\begin{proof}
		We can see that for instance for $\alpha_1$ one of the roots of $C(x)$ we have
		\begin{align*}
			\li \left(\frac{y}{x-\alpha_1}\right) &= (t^{-2} - \alpha_1)^{-1} t^{-5} \sqrt{\tau_3}\\
			&= t^2 (1 + \dots)^{-1} t^{-5}(1 + \dots)\\
			&= t^{-3} (1 + \dots).
		\end{align*}
		So if $\li (f) = \gamma t^{-3} + \dots$ then per Lemma \ref{twopol} we have
		\begin{align*}
			f - \gamma \frac{y}{x-\alpha_1} = \alpha + \beta x.
		\end{align*}
		But now for $\q = (\alpha_0, 0)$ we have
		\begin{align*}
		  \lp (f) &= \alpha + \beta (\alpha_1 + t^2) + \gamma \frac{\nu t \sqrt \tau_2}{t^{2}}\\
		  &= \gamma \nu t^{-1} + \dots
		\end{align*}
		so $\gamma \nu$ must be 0. Since $\nu = C'(x_0) \neq 0$ and $f$ does not have any poles in $\enkb$, $\gamma$ must be zero and so $f = \alpha + \beta x$.
		%We have $\lp (f) = \gamma t^{-3} + \dots$ and so $\lp (f - \bar f) = \delta t^{-2} + \dots$ because the order at infinity of $f - \bar f \in K(x)$ must be even by Lemma \ref{two} (c).


	\end{proof}
\end{lemma}

\begin{lemma}
	If $f \in \F^*$ has at most four poles at $\infty$ then $f$ is of the form $f = \alpha + \beta x + \gamma x^2$ with $\alpha, \beta, \gamma \in K$.
	\begin{proof}
	  With $\li (f) = \gamma t^{-4} + \dots$ we know that $\li (f - \gamma x^2) = \delta t^{-3} + \dots$ and we use the previous Lemma to see that $f - \gamma x^2 = \alpha + \beta x$.
	\end{proof}
\end{lemma}

\end{document}