\documentclass[english,11pt,a4paper]{article}
\usepackage{preamble}

\begin{document}

Version 1 \scriptsize \hfill Juri; Hyperelliptic Curves --- Draft --- \today
\normalsize

\section{Rational Functions on Hyperelliptics}

The goal of this chapter is to look at rational functions on the curve $y^2 = C(x)$ and to develop a reasonable notion of the order of a function in a point on the curve. We then give some basic properties for this order function before we introduce divisors and proceed to look at functions with a specified number of poles at infinity as a final preparation for the proof of associativity on $\J$. xxx %introduce divisors with the ultimate goal of xxx Blah

% \subsection{The Function Field}
\subsection{Function Field and Order of Rational Functions}

\begin{defin}
	Define the ring of rational functions on the curve as
	\begin{align*}
	  \F = \bigslant{K(x)[y]}{\big(y^2-C(x)\big)}.
	\end{align*}
  % Define $\F$ to be the ring \scalebox{1.2}{$\nicefrac{K(x)[y]}{(y^2-C(x))}$}. Because \mbox{$y^2-C(x)$} is irreducible in $K(x)[y]$ the ideal it generates is maximal and so $\F$ is a field.
  As $y^2-C(x)$ is irreducible in $K(x)[y]$, this is a field
  % xxx want me to write why?
  and $\F = K(x) + K(x) y$, so write elements $f \in \F$ as $f = g + hy$ where $g,h \in K(x)$. Define $\bar f = g - hy$.

  We will occasionally write things like $K[x,y] \subset \F$ but xxx we always implicitly mean this in conjunction with $y^2=C(x)$.
\end{defin}

\begin{center}
$\sim$
\end{center}

We now wish to define the order of a function $f$ in a point $\q$, $\ordq (f) \in \mathbbm{Z}$ for $f \in \F^*$ and $\q \in \ekb$. To this end we first construct a $K$-homomorphism
\begin{align*}
  \lp: \F \rightarrow \bar K (\! (t)\! )
\end{align*}
with the intent of defining $\ordq(f) = \ord \lp (f)$.
% and use this to define $\ordq(f) = \ord \lp (f)$. For that purpose, we only need to define $\lpx$ and then find $\lpy$ through $\lpy^2 = C(\lpx)$ Distinguish between three cases for $\q$:
	%We want to define the order of a point $\q \in \ek$ on $\F$ ...construct


\textbf{Reminder}: If $\tau$ is a formal Laurent series of the form $\tau = 1 + \sum_{i = 1}^{\infty} a_i t^i$ then it has a unique squareroot of the form $\sigma = 1+\sum_{i = 1}^{\infty} b_i t^i$ meaning $\sigma^2 = \tau$. Write $\sigma = \sqrt \tau = 1 + \dots$.

From now on we will use an ellipsis to denote terms of ascending order everywhere where we are not interested in the specifics.

\begin{defin}
	Because $C\big(\lpx\big)=\big(\lpy\big)^2$ has to be fulfilled, we first decide on $\lpx$ and deduce $\lpy$. For this, we distinguish between three cases for $\q \in \ekb$:
	\begin{enumerate}[1.]
		\item Let $\q =(x_0,y_0) \in \enkb$ with $y_0 \neq 0$ and consequently $C(x_0)\neq 0$.

		Define $\lpx = x_0 + t$. Now
		\begin{align*}
		  C(\lpx) &= C(x_0+t)\\
		          &= C(x_0)+ \dots + t^5\\
		          &= C(x_0)(1 + \dots)\\ % \text{ since } C(x_0) = y_0^2\neq 0\\
		          &= y_0^2 \tau_1 \text{\hspace{5mm} with } \tau_1 \in K (\! (t)\! ).
		\end{align*}
		Define $\lpy = y_0 \sigma_1$ where $\sigma_1 = \sqrt{\tau_1}$.

		\item Let $\q =(x_0,y_0) \in \enkb$ with $y_0 = 0$.	Note that $C(x_0)=0$ and write $C(x)=\prod_{i=1}^5 (x-\alpha_i)$ for $\alpha_i \in \bar K$ and for instance $\alpha_1 = x_0$.

		Define $\lpx = x_0 + t^2$. Now
		\begin{align*}
		  C(\lpx) &= t^2 \prod_{i=2}^5 (x_0 -\alpha_i + t^2) \\
		          % &= \mu t^2 + \dots\\
		          &= \mu t^2 (1 + \dots)
		\end{align*}
		with $\mu \in \bar K$ being $\prod_{i=2}^5 (x_0 - \alpha_i) = C'(x_0)$ which is non-zero because our curve is non-singular. Write therefore $C(\lpx) = \mu t^2 \tau_2$ with $\tau_2 = 1 + \dots$ and define $\lpy = \nu t \sigma_2$ with $\sigma_2 = \sqrt{\tau_2}$ and $\nu^2 = \mu$.%$\nu = \sqrt{\mu}$ for a fixed $\sqrt{\phantom{j}}:K\rightarrow K$.

		\item Let $\q = \infty$. Define $\lpx = \frac{1}{t^2}$. It follows that
		\begin{align*}
			C(\frac{1}{t^2}) &= \frac{1}{t^{10}} + \frac{a}{t^8} + \frac{b}{t^6}
											  + \frac{c}{t^4}    + \frac{d}{t^2} + e\\
											 &= \frac{1}{t^{10}} (1 + \dots)
		\end{align*}
		So define $\lpy = \frac{1}{t^5}\sigma_3$ with the notation $\sigma_3 = \sqrt{\tau_3}$ as before.
	\end{enumerate}
\end{defin}

\begin{defin}
   For $\q \in \ekb$ and $f \in \F^*$ define $\ordq (f) = \ord \lp (f)$.
\end{defin}

% \begin{center}
% $\sim$
% \end{center}
% \vspace{0.6mm}

\begin{lemma}\label{one}
  Let $f \in K[x,y] \subset \F$, $f \neq 0$ and $\q \in \enkb$, $\q = (x_0,y_0)$. Then
  \begin{enumerate}[(a)]\parskip 1mm
	  \item ord$_{\q} f \geq 0$ and
	  \item if $f(\q) = 0$ then ord$_{\q} f \geq 1$.
	\end{enumerate}\parskip 3mm
	\begin{proof}\hfill
		\begin{enumerate}[(a)]\parskip 1mm
	  	\item Because $\q \in \enkb$ we have $\lpx$, $\lpy \in \bar K[[t]]$ and with $f \in K[x,y]$ we have $\ordq (f) \in \mathbbm{N}$.
	  	\item Write $f = A(x,y)$, $A(X,Y) \in K[X,Y]$. First, let $y_0 \neq 0$.
	  	\begin{align*}
	  	  \ordq f &= \ord A(\lpx, \lpy)\\
	  	  &= \ord A(x_0 + t, y_0 \sigma_1).
	  	\end{align*}
	  	But $A(x_0 + t, y_0 \sigma_1)=\sum_{i=0}^{\infty} a_i t^i$ so with $t=0$ we get $A(x_0, y_0)=a_0$ but the former is $f(\q)$ which is $0$, so $a_0 = 0$ and the claim follows.

	  	If $y_0 = 0$ we would have $\ordq f = \ord A(x_0 + t^2, \sqrt \mu t \sigma_2)$ instead. But like before, this means $0 = f(\q) = A(x_0, 0) = a_0$ so again $\ordq (f) \geq 1$.
		\end{enumerate}\parskip 3mm
	\end{proof}
\end{lemma}

\begin{lemma}\label{two}
  Let $f \in K(x)$, $f \neq 0$, $\q \in \ekb$. Then
  \begin{enumerate}[(a)]\parskip 1mm
	  \item $\ordq (f) = \ordx f(x)$ if $\q = (x_0,y_0) \in \enkb$ with $y_0 \neq 0$.
	  \item $\ordq (f) = 2 \ordx f(x)$ if $\q = (x_0,0) \in \enkb$.
	  \item $\ordi (f) = 2 \ordn f(\frac{1}{x}) = 2 \ordii f(x)$.
	\end{enumerate}\parskip 3mm
	\textbf{Note} that the righthand sides of the equalities refer to the usual definition of the order of a rational function in a point $x_0 \in \bar K \cup \{ \ii \}$.%xxx We renamed the infinity in order to avoid a clash of notations.
	\begin{proof}
		First take $f \in K[x]$ and define $e = \ordx f \in \mathbbm{N}$ so $f = (x-x_0)^e g(x)$ with $g \in \bar K[x]$ and $g(x_0)\neq 0$.
		\begin{enumerate}[(a)]
	  	\item If $\q =(x_0,y_0)$, $y_0 \neq 0$ then $\lp (f) = f(x_0 + t) = t^e g(x_0 + t)$ and so $\ord \lp (f) = e$ because $g(x_0 + t) = g(x_0) + \dots$ with $g(x_0) \neq 0$.

	  	\item Here $\lp (f) = f(x_0 + t^2) = t^{2e} g(x_0 + t^2)$ and again $g(x_0 + t^2) = g(x_0) + \dots$ so $\ord \lp (f) = 2e$.

	  	\item For $\q = \infty$ we have $\lp (f) = f(\frac{1}{t^2}) = \frac{\alpha}{t^{2d}}+ \dots$ with $\alpha \neq 0$ if $d = \deg f$. Obviously, $\ordn f(\frac 1 x ) = \ordn \frac{\alpha + \dots}{x^d} = -d$ so $\ord \lp (f) = 2 \ordn f(\frac 1 x )$.
		\end{enumerate}
		Generally, if $f \in K(x)$ we can write $f = \frac p q$ for $p, q \in K[x]$ and we apply the above to $p$ and $q$, subtracting $\ordq q$ from $\ordq p$.
	\end{proof}
\end{lemma}

\begin{lemma}\label{three}
  For $f \in \F^*$ and $\q \in \ekb$ the order satisfies $\ordq(\bar f) = \ordbq (f)$
  \begin{proof} Split into three possible cases:
    \begin{enumerate}[1.]
    	\item For $\q \in \enkb$ with $y_0 \neq 0$ we've got $\lpx = x_0 + t$ and $\lpy = y_0 \sqrt \tau$. Therefore $\lpbx = x_0 + t = \lp (\bar x)$ and $\lpby = - y_0 \sqrt \tau = \lp (\bar y)$ so
    	\begin{align*}
    	  \lpb (f(x,y)) &= f(\lpbx , \lpby ) \\
    	  							&= \lp (f(\bar x, \bar y)) \\
    	  							&= \lp (\bar f (x,y)).
    	\end{align*}

    	\item If $\q \in \enkb$ with $y_0 = 0$ then $\bar \q = \q$. Write $f = g(x) + h(x)y$ so
    	\begin{align*}
    	  \lp (\bar f) &= g(x_0 + t^2) - h(x_0 + t^2) \nu t \sqrt{\tau}.
    	\end{align*}
    	Calling this $l(t) = \lp (\bar f)$ and looking at the construction of $\lp$ we see that $\tau$ sports only even powers of $t$ so we see above that $l(-t) = \lp (f)$. As interchanging $t$ with $-t$ doesn't change the order, we're done.

    	\item For $\q = \infty$, $\tau = 1 + a t^2 + b t^4 + c t^6 + d t^8 + c t^{10}$ features only even powers as well, so again $l(-t) = \lp (f)$ for $l(t) = \lp (\bar f) = g(\frac{1}{t^2}) - h(\frac{1}{t^2}) \frac{1}{t^5} \sqrt{\tau}$. Finally, $\lp (f)$ is equal to $\lpb (f)$ since $\infty = \bar \infty$. Again $\ord l(t) = \ord l(-t)$.
    \end{enumerate}
  \end{proof}
\end{lemma}

\begin{lemma}\label{sform}
  %(Summenformel)
  If $f \in \F^*$ then the set $\big \{ \q \in \ekb \ \big | \ \ordq f \neq 0 \big \}$ is finite and 
  \begin{align*}
    \sum_{\q \in \ekb} \ordq f = 0.%\tag{Summenformel}
  \end{align*}
  \begin{proof}
    First take $f \in K[x,y]$, $f \neq 0$ and let $\q = (x_0,y_0) \in \enkb$ with $\ordq f \neq 0$. By Lemma \ref{one} (a) we know that $\ordq f \geq 1$. It follows that $\ordq (f \bar f) = \ordq f + \ordq \bar f \geq 1$. Now since $f = g + h y$, $f \bar f = g^2 - h^2 C(x)$ which lies in $K[x]$, so by Lemma \ref{two} we have $\ordx (f \bar f) > 0$. But there are only finitely many such $x_0$ and so only finitely many $y_0 = \pm \sqrt{C(x_0)}$.

    For $f \in K(x,y)$, $f = \frac{f_1}{f_2}$, $f_1, f_2 \in K[x,y]$ we have $\ordx f = \ordx f_1 - \ordx f_2$ so there are also only finitely many $x_0$ for which this differs from zero.

    For the second claim, give a name to our sum
    \begin{align*}
      s(f) &= \sum_{\q \in \ekb} \ordq f \\
      		 % \stackrel{=}{\text{Lemma \ref{three}}} 
      \intertext{and note that $s(f) = s(\bar f)$ due to Lemma \ref{three} and the fact that we take the sum over all $\q$. Because $\ordq (f \bar f ) = \ordq (f) + \ordq ( \bar f )$ we can see that}
      s(f \bar f) &= s(f) + s(\bar f) = 2 s(f).
    \end{align*}
    But because $f \bar f \in K(x)$ we can use Lemma \ref{two} to write this out as
    \begin{align*}
      2s(f) &= \sum_{\q \in \ekb} \ordq f \bar f\\
      			&=2 \sum_{\stackrel{x_0 \neq \infty}{x_0 \neq \alpha_i}} \ordx f \bar f 
      			+ 2 \sum_{x_0 = \alpha_i} \ordx f \bar f 
      			+ 2 \sum_{x_0 = \infty} \ordx f \bar f\\
      			&=2 \sum_{x_0 \in \bar K \cup \{ \infty \}} \ordx f \bar f.
      			%&= \underbrace{2\sum_{\stackrel{x_0 \neq \infty}{x_0 \neq \alpha_i}} \ordx f \bar f}_{Test} + \underbrace{2\sum}_{\text{Lemma \ref{two} (b)}} + \underbrace{2\sum}_{\text{Lemma \ref{two} (c)}}
    \end{align*}
    Here $\alpha_i$ are the points on which $C(x)$ vanishes % and the $2$ in the first term stems from the fact that every $x_0$ comes from two points, $\q$ and $\bar \q$.
    and since
    \begin{align*}
    	\sum_{x_0 \in \bar K \cup \{ \infty \}} \ordx g = 0
    \end{align*}
    for any $g \in K(x)$ we have $2s(f)=0$ meaning $s(f) = 0$ in $\mathbbm{Z}$.
  \end{proof}
\end{lemma}

% \begin{center}
% $\sim$
% \end{center}

\subsection{Divisors and Lemmas}

% $\widehat{\infty}$ $\tilde{\infty}$ $\bar{\infty}$ $\breve{\infty}$ $\check{\infty}$ $\underline{\infty}$

% $\ord_{\widehat{\infty}} f(x)$ $\ord_{\tilde{\infty}} f(x)$ $\ord_{\underline{\infty}} f(x)$ $\ord_{\breve{\infty}} f(x)$ $\ord_{\check{\infty}} f(x)$

\begin{defin}
  The divisor of a function $f \in \F$ is the formal sum
  \begin{align*}
    (f) = \sum_{\q \in \ekb} \ordq f \cdot \q
  \end{align*}
  where $(f) = 0$ if $f = 0$. Thanks to Lemma \ref{sform} the sum is finite and the sum of all coefficients is 0.

  Points $\q \in \ekb$ with a positive coefficient in $(f)$ are called zeroes of $f$ while those with a negative coefficient are called poles.
\end{defin}

\begin{lemma}\label{nopol}
	If $f \in \F^*$ has no poles then $f$ is constant.
	\begin{proof}
	  With $f = g + hy$, $\ordq f \geq 0$ for every $\q \in \ekb$ we take a look at $f + \bar f = 2g \in K(x)$ and $f \bar f = g^2 - h^2 C \in K(x)$ and observe that
	  \begin{align*}
	    \ordq (f + \bar f) &\geq \min \{ \ordq f , \ordq \bar f \} \\
	    		&= \min \{ \ordq f , \ordbq f\} \geq 0.
	    \intertext{with Lemma \ref{three} and similarly}
	    \ordq (f \bar f) &= \ordq f + \ordbq f \geq 0.
	  \end{align*}
	  Both are greater than zero because $f$ has no poles and with the help of Lemma \ref{two} we conclude that $\ordx (f + \bar f) \geq 0$ and $\ordx (f \bar f) \geq 0$ respectively.

	  But in $\bar K(x)$, a function $q$ with $\ordx q \geq 0$ for every $x_0 \in \bar K \cup \{ \ii \}$ must be constant, so both $f + \bar f$ and $f \bar f$ are constant functions. Since $f$ is a root of $(T-f)(T-\bar f) = T^2 - (f + \bar f)T + f \bar f$ which lies in $\bar K[T]$, $f$ lies in $\bar K$.
	\end{proof}
\end{lemma}

\begin{theorem}\label{satz1}
  Let $x = x(t)$, $y = y(t) \in K(t)$ such that $y(t)^2 = C(x(t))^2$. Then $x(t)$, $y(t) \in K$.
\end{theorem}

\begin{lemma}
	Suppose $f \in \F^*$ has at most one pole at $\infty$ i.e. $\ordi f \geq -1$ and none for any other $\q \in \enkb$ so $\ordq f \geq 0$. Then $f$ is a constant.

	\begin{proof}
		With $f = g+hy$ such that $\ordq f \geq 0$ for every $\q \in \enkb$ and $\ordi f = -1$ we can write $\li (f) = \frac \kappa t + \dots$ with $\kappa \in \bar K$. Since we are only interested in the order, replace $f$ with $\frac f \kappa$ so $\li (f) = \frac 1 t + \dots$.
		%With $f = g+hy$ such that $\ordq f \geq 0$ for every $\q \in \enkb$ we can assume that $\ordi f = -1$ because Lemma~\ref{nopol}. and $\li (f) = \frac 1 t + \dots$. If the trailing coefficient of $\li (f)$ were different from one, we can always xxx where $\alpha \in \bar K$. Due to  we assume that $\alpha \neq 0$ and may even take $\alpha = 1$ by replacing $f$ with $\frac f \alpha$.

		Now remember that $\li (x) = \frac{1}{t^2}$ so $\li (x - f^2) = \frac \alpha t + \dots$, $\alpha \in \bar K$ and finally we have a regular power series $\li (x - f^2 - \alpha f)$ so
		\begin{align*}
		  \ordi (x - f^2 - \alpha f) &\geq 0\\
		\intertext{and for any other $\q \in \enkb$ we have}
		  \ordq (x - f^2 - \alpha f) &\geq \min \{ \ordq (x) , \ordq (f^2) , \ordq f \}
		\end{align*}
		which is positive by virtue of the prerequisite on $f$ and $\lpx = x_0 + \dots$. The previous Lemma now implies $x - f^2 - \alpha f \in \bar K$ so we see $x = f^2 + \alpha f$ as a polynomial $x = X(f)$ with $X(T) \in \bar K[T] \setminus \bar K$.

		Do the same thing with $\lpy = \frac{1}{t^5}\sqrt \tau = \frac{1}{t^5} + \dots$ so
		\begin{align*}
		  \lp (y - f^5) &= \frac{\beta_4}{t^4} + \dots,\\
		  \lp (y - f^5 - \beta_4 f^4) &= \frac{\beta_3}{t^3} + \dots
		\end{align*}
		and so on, so finally $\lp (y - f^5 - \beta_4 f^4 - \beta_3 f^3 - \beta_2 f^2 - \beta_1 f)$ is a power series again and must be in $\bar K$. As before $y = f^5 + \beta_4 f^4 + \beta_3 f^3 + \beta_2 f^2 + \beta_1 f = Y(f)$ with $Y(T)\in \bar K[T] \setminus \bar K$.

		Combined we have $Y(f)^2 = C(X(f))$ but $K$ is algebraically closed, so either $f \in \bar K$ or $Y(T)^2 = C(X(T))$. The latter can't be true by Theorem \ref{satz1} and the former is in contradiction to $\ordi f = -1$, so actually $\ordi f \geq 0$.% so $\left. Y(T)^2 - C(X(T)) \right|_{T=f} = 0$. This means that either
	\end{proof}
\end{lemma}

\begin{lemma}
	If $f \in \F^*$ has at most two poles at $\infty$ then $f$ is of the form $f = \alpha + \beta x$ with $\alpha, \beta \in K$.
	\begin{proof}
	
	\end{proof}
\end{lemma}

\begin{lemma}
	If $f \in \F^*$ has at most three poles at $\infty$ then $f$ is of the form $f = \alpha + \beta x$ with $\alpha, \beta \in K$.
	\begin{proof}
	
	\end{proof}
\end{lemma}

\begin{lemma}
	If $f \in \F^*$ has at most four poles at $\infty$ then $f$ is of the form $f = \alpha + \beta x + \gamma x^2$ with $\alpha, \beta, \gamma \in K$.
	\begin{proof}
	
	\end{proof}
\end{lemma}










\fline

\textbf{Minilemma 1}: If $f$ is such that $\lambda_\infty (f)=\gamma t^e + \dots$ then $\lambda_\infty (\bar f)=-\gamma t^e + \dots$

\begin{proof}
	Let $\lambda_\infty (\bar f) = \tilde \gamma t^e + \dots$. Since $f + \bar f = 2p$ and ord$_\infty(p)$ is always even for $p \in K(x)$, we must have $(\gamma + \tilde \gamma)t^{-3} + \dots = \sigma t^{-2} + \dots$ so $\gamma = - \tilde \gamma$.
\end{proof}

\textbf{Lemma 2:} Let $f \in \F^*$ with $(f)=\frac{***}{3\infty}$. Then $f = \alpha + \beta x$.
\begin{proof}
	Let $f=p+qy$ with $p, q \in K(t)$. We have $\lambda_\infty (f + \bar f) = \sigma t^{-2} + \dots$ so $p = \frac{1}{2} (f+\bar f) = \alpha + \beta x$.

	Now, consider $f-\bar f = 2qy$. We get $\lambda_\infty (f-\bar f) = 2 \lambda_\infty (q) t^{-5} \sqrt \tau = 2 \gamma t^{-3}+\dots$ and since $\sqrt \tau$ is a a series of the form $1 + \dots$ we must have $\lambda_\infty (q) = \gamma t^2 + \dots$

	Suppose $q \neq 0$, this implies $\frac{1}{q} = \tilde \delta + \tilde \epsilon x$. Rewriting to accomodate for $q=0$ gives $q=\frac{\epsilon}{x-\delta}$ with $\delta, \epsilon \in K$ as well so
	\begin{align*}
	  f=\alpha + \beta x +\frac{\epsilon}{x-\delta}y
	\end{align*}
	However, now $\lambda_\q (f) = \alpha + \beta (t^2+\delta) + \epsilon \sqrt \mu \frac{t \sqrt \tau}{t^2}$ for $\q = (\delta,0)$ which is equal to $\epsilon \sqrt \mu t^{-1} + \dots$. If $\epsilon \neq 0$ ($\mu$ is non zero anyway) this means that $\q$ is a new (true) pole for $f$ which contradicts $(f)=\frac{***}{3\infty}$, so $q$ must be 0.
\end{proof}

\textbf{Lemma 3:} Let $f \in \F^*$ with $(f)=\frac{****}{4\infty}$. Then $f = \alpha + \beta x + \gamma x^2$.

\begin{proof}
	(different function $f$): With $\lambda_\infty(f) = \gamma t^{-4}+\dots$ so $\lambda_\infty(f-\gamma x^2)$ being of the form $\sigma t^{-3}+\dots$ we fall into the case above and the claim follows.
\end{proof}
\vspace{-8mm}
\fline

\end{document}